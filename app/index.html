
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>User Profile</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background-color: #f8f8f8;
    }
    .container {
        margin: 40px auto;
        width: 80%;
        max-width: 500px;
        background-color: #fff;
        padding: 20px 30px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        border-radius: 8px;
    }
    .button {
        width: 160px;
        height: 45px;
        border-radius: 6px;
        font-size: 15px;
        margin-top: 20px;
        cursor: pointer;
        background-color: #007bff;
        color: white;
        border: none;
    }
    .button:hover {
        background-color: #0056b3;
    }
    img {
        width: 150px;
        height: 150px;
        border-radius: 50%;
        display: block;
        margin: 0 auto 20px;
        object-fit: cover;
    }
    hr {
        margin: 15px 0;
    }
    label {
        display: block;
        font-weight: bold;
        margin-bottom: 5px;
    }
    input {
        width: 100%;
        height: 32px;
        font-size: 15px;
        padding: 4px 8px;
        margin-bottom: 15px;
        box-sizing: border-box;
    }
    #container-edit {
        display: none;
    }
</style>
</head>
<body>
    <!-- Profile Display -->
    <div class="container" id="container">
        <h1>User Profile</h1>
        <img id="profile-img" src="default-profile.png" alt="User Profile">
        <div><strong>Name:</strong> <span id="name">Anna Smith</span></div>
        <hr />
        <div><strong>Email:</strong> <span id="email">anna.smith@example.com</span></div>
        <hr />
        <div><strong>Interests:</strong> <span id="interests">coding</span></div>
        <hr />
        <button class="button" onclick="editProfile()">Edit Profile</button>
    </div>

    <!-- Profile Edit -->
    <div class="container" id="container-edit">
        <h1>Edit Profile</h1>
        <img id="profile-img-edit" src="default-profile.png" alt="User Profile">
        <label for="input-name">Name:</label>
        <input type="text" id="input-name" placeholder="Enter name" />
        <label for="input-email">Email:</label>
        <input type="email" id="input-email" placeholder="Enter email" />
        <label for="input-interests">Interests:</label>
        <input type="text" id="input-interests" placeholder="Enter interests" />
        <button class="button" onclick="handleUpdateProfileRequest()">Update Profile</button>
    </div>

<script>
(async function init() {
    try {
        const response = await fetch('/get-profile');
        if (!response.ok) throw new Error("Failed to fetch profile");
        const user = await response.json();

        // Populate profile fields
        document.getElementById('name').textContent = user.name || 'Anna Smith';
        document.getElementById('email').textContent = user.email || 'anna.smith@example.com';
        document.getElementById('interests').textContent = user.interests || 'coding';

        // Set profile image if provided
        if(user.picture) {
            document.getElementById('profile-img').src = user.picture;
            document.getElementById('profile-img-edit').src = user.picture;
        }

        document.getElementById('container').style.display = 'block';
    } catch (err) {
        console.error("Error loading profile:", err);
        alert("Could not load profile. Please check your server.");
    }
})();

function editProfile() {
    const profileContainer = document.getElementById('container');
    const editContainer = document.getElementById('container-edit');

    // Prefill edit inputs
    document.getElementById('input-name').value = document.getElementById('name').textContent;
    document.getElementById('input-email').value = document.getElementById('email').textContent;
    document.getElementById('input-interests').value = document.getElementById('interests').textContent;

    profileContainer.style.display = 'none';
    editContainer.style.display = 'block';
}

async function handleUpdateProfileRequest() {
    const profileContainer = document.getElementById('container');
    const editContainer = document.getElementById('container-edit');

    const payload = {
        name: document.getElementById('input-name').value,
        email: document.getElementById('input-email').value,
        interests: document.getElementById('input-interests').value
    };

    try {
        const response = await fetch('/update-profile', {
            method: "POST",
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(payload)
        });

        if (!response.ok) throw new Error("Failed to update profile");
        const updatedUser = await response.json();

        // Update display
        document.getElementById('name').textContent = updatedUser.name;
        document.getElementById('email').textContent = updatedUser.email;
        document.getElementById('interests').textContent = updatedUser.interests;

        profileContainer.style.display = 'block';
        editContainer.style.display = 'none';
    } catch (err) {
        console.error("Error updating profile:", err);
        alert("Could not update profile. Please try again.");
    }
}
</script>
</body>
</html>

